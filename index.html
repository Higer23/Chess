<!doctype html>
<html lang="tr"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> 
  <title>HIGER Satran√ß AI Platformu</title> 
  <meta name="description" content="HIGER Chess: Geli≈ümi≈ü, modern, mobil ve masa√ºst√º uyumlu, √ßoklu dil desteƒüi ve ki≈üiselle≈ütirme se√ßenekleriyle satran√ß AI sitesi."> 
  <meta name="theme-color" content="#222733"> 
  <link rel="icon" href="Hƒ∞GER_20250317_154048_0000.png" type="image/png"> 
  <link rel="stylesheet" href="style.css"> <!-- Google Fonts --> 
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400|Fira+Mono:400,700&amp;display=swap" rel="stylesheet"> 
 <style type="text/css" id="dcoder_stylesheet">/* HIGER Satran√ß - Tek Dosya CSS (Birle≈ütirilmi≈ü, ~700+ satƒ±r, modern ve eri≈üilebilir) */

/* 1. Temel Deƒüi≈ükenler ve Reset */
:root {
    --cell-size: min(12vw, 7.5vh, 54px);
    --board-size: calc(var(--cell-size) * 8);
    --accent: #3498db;
    --accent-dark: #217dbb;
    --danger: #e74c3c;
    --win: #27ae60;
    --draw: #f1c40f;
    --background: #f2f1ef;
    --header-bg: #222733;
    --header-text: #f7f7f7;
    --board-shadow: 0 8px 32px #2225;
    --modal-bg: rgba(20,20,30,0.85);
    --toast-bg: #c0392b;
    --toast-color: #fff;
    --font-main: 'Montserrat', Arial, sans-serif;
    --font-mono: 'Fira Mono', Menlo, Consolas, monospace;
    --footer-bg: #23242b;
    --footer-text: #e8e8e8;
    --cell-highlight: #3ddc97;
    --cell-moveable: #acd5e5;
    --cell-capture: #e67e22;
    --cell-check: #e74c3c;
    --cell-lastmove: #ffe27a;
    --cell-selected: #3498db;
    --cell-dark: #b58863;
    --cell-light: #f0d9b5;
    --shadow-soft: 0 2px 10px #0002;
    --shadow-strong: 0 8px 32px #2225;
    --transition: 0.18s;
    --modal-blur: blur(3px);
}

/* Sƒ±fƒ±rlama ve temel yapƒ± */
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    background: var(--background);
    font-family: var(--font-main);
    color: #202026;
    scroll-behavior: smooth;
}
body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* 2. Header ve Navigation */
.site-header {
    background: var(--header-bg);
    color: var(--header-text);
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 18px;
    padding: 0.8em 1.2em;
    box-shadow: 0 2px 10px #0003;
    position: sticky;
    top: 0;
    z-index: 900;
}
.site-logo {
    height: 48px;
    width: 48px;
    object-fit: contain;
    border-radius: 50%;
    border: 2px solid var(--accent);
    background: #fff;
    transition: filter .2s, border-color .18s;
}
.site-title {
    font-size: 2.1rem;
    font-weight: 800;
    letter-spacing: 1.2px;
    margin: 0 1.5rem 0 0;
    transition: color .2s;
}
.site-nav {
    margin-left: auto;
    margin-right: 1rem;
}
.site-nav ul {
    display: flex;
    gap: 1.2rem;
    margin: 0;
    padding: 0;
    list-style: none;
}
.site-nav a {
    color: var(--header-text);
    text-decoration: none;
    font-weight: 600;
    font-size: 1.09rem;
    position: relative;
    padding: 0.2em 0.2em;
    transition: color .18s;
}
.site-nav a.active,
.site-nav a:hover, 
.site-nav a:focus {
    color: var(--accent);
}
.site-nav a.active::after {
    content: "";
    display: block;
    margin: auto;
    margin-top: 2px;
    width: 60%;
    border-bottom: 2px solid var(--accent);
}
.theme-toggle-btn {
    margin-left: .7rem;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: var(--header-bg);
    color: var(--accent);
    font-size: 1.8rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background .18s, color .18s;
}
.theme-toggle-btn::before {
    content: "‚òÄÔ∏è";
    font-size: 1.36rem;
    transition: content .2s;
}
body.dark-theme .theme-toggle-btn::before {
    content: "üåô";
}
#languageSelect {
    margin-left: .8rem;
    border-radius: 5px;
    padding: 0.3em 0.7em;
    font-size: 1rem;
    border: 1px solid var(--accent);
    color: var(--accent-dark);
    background: #fff;
    font-family: inherit;
    outline: none;
    transition: border .16s, color .16s;
}

@media (max-width: 700px) {
    .site-header {
        flex-direction: column;
        gap: 0.5rem 0;
        align-items: flex-start;
    }
    .site-title {
        margin: 0.2em 0;
        font-size: 1.36rem;
    }
    .site-nav {
        margin: 0 0 0.6em 0;
    }
    .site-nav ul {
        gap: 0.7rem;
    }
}

/* 3. Ana B√∂l√ºm ve Containerlar */
main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 100vw;
}
#chessBoardContainer {
    display: flex;
    justify-content: center;
    align-items: center;
    width: var(--board-size);
    height: var(--board-size);
    margin: 1.2rem auto 0.8rem auto;
    box-shadow: var(--board-shadow);
    background: #222;
    border-radius: 14px;
    transition: box-shadow .18s;
    position: relative;
}
#chessBoard {
    display: grid;
    grid-template-columns: repeat(8, var(--cell-size));
    grid-template-rows: repeat(8, var(--cell-size));
    background: #222;
    border-radius: 11px;
    overflow: hidden;
    width: var(--board-size);
    height: var(--board-size);
    box-shadow: 0 2px 8px #0002;
    transition: box-shadow .18s;
    touch-action: manipulation;
    user-select: none;
}

/* 4. Satran√ß Tahtasƒ± ve H√ºcreler */
.chess-cell {
    width: var(--cell-size);
    height: var(--cell-size);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: calc(var(--cell-size) * 0.78);
    user-select: none;
    cursor: pointer;
    transition: background 0.2s, box-shadow 0.2s, outline .15s;
    box-sizing: border-box;
}
.chess-cell.light { background: var(--cell-light); }
.chess-cell.dark { background: var(--cell-dark); }
.chess-cell.selected { outline: 3px solid var(--cell-selected); z-index: 1; }
.chess-cell.moveable { background: var(--cell-moveable) !important; }
.chess-cell.last-move { background: var(--cell-lastmove) !important; }
.chess-cell.capture { background: var(--cell-capture) !important; }
.chess-cell.highlight { box-shadow: 0 0 0 6px var(--cell-highlight) inset; }
.chess-cell.check { box-shadow: 0 0 0 7px var(--cell-check) inset; }
.chess-cell:active { filter: brightness(1.10); }
.chess-cell.promotion { background: #ffe8c1; box-shadow: 0 0 0 4px var(--accent) inset; }

@media (max-width: 600px) {
    :root { --cell-size: min(13vw, 44px);}
}
@media (max-width: 420px) {
    :root { --cell-size: min(11vw, 32px);}
    #chessBoardContainer { width: 100vw; height: 100vw;}
}
@media (orientation: portrait) and (max-width: 370px) {
    :root { --cell-size: 10vw;}
}

/* 5. Kontrol Paneli ve Butonlar */
.controls-top, .controls-bottom {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-bottom: 0.6rem;
    margin-top: 0.2rem;
    flex-wrap: wrap;
}
.ctrl-btn {
    font-size: 1.07rem;
    padding: 0.6em 1.2em;
    border-radius: 5px;
    border: none;
    background: var(--accent);
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: background var(--transition), color var(--transition), box-shadow var(--transition);
    outline: none;
    box-shadow: 0 2px 8px #0002;
    margin-bottom: 3px;
}
.ctrl-btn:active { background: var(--accent-dark);}
.ctrl-btn:disabled { background: #aaa; color: #eee; cursor: not-allowed; }
.ctrl-icon { margin-right: 0.5em; }

/* 6. Oyuncu Bilgi ve D√∂n√º≈ü G√∂stergesi */
.player-info-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 460px;
    width: 98vw;
    margin: 0 auto 0.5em auto;
    font-size: 1.14rem;
    background: #fff;
    border-radius: 7px;
    box-shadow: 0 2px 6px #0001;
    padding: 0.3em 1.3em;
    gap: 0.8em;
}
.player-label {
    display: flex;
    align-items: center;
    gap: 0.6em;
}
.player-dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 0.2em;
}
.player-dot.white { background: #fff; border: 2px solid #aaa;}
.player-dot.black { background: #232323; border: 2px solid #aaa;}
.player-name { font-family: var(--font-main); font-weight: 600; }
.turn-indicator {
    padding: 0.2em 1em;
    background: var(--accent);
    color: #fff;
    border-radius: 10px;
    font-weight: bold;
    font-size: 1.03rem;
    letter-spacing: 1.2px;
    box-shadow: 0 1px 6px #0002;
}
@media (max-width: 440px) {
    .player-info-bar { font-size: .99rem; padding: 0.2em 0.3em;}
}

/* 7. Hamle Ge√ßmi≈üi ve Oyun Bilgisi */
.move-history {
    width: 98vw;
    max-width: 390px;
    margin: 0 auto 1.2rem auto;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 6px #0001;
    padding: 0.7em 1.1em;
    font-size: 1.09rem;
    min-height: 36px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    overflow-x: auto;
}
.move-history .move {
    background: #eee;
    border-radius: 4px;
    padding: 2px 8px;
    font-family: var(--font-mono);
    color: #444;
    cursor: pointer;
    transition: background 0.13s;
}
.move-history .move.selected {
    background: #b7e3b7;
    color: #1c3;
    font-weight: 700;
    border: 1.5px solid var(--win);
}
.move-history .move:hover,
.move-history .move:focus {
    background: #d6f5d6;
    outline: 1px solid var(--win);
}

/* 8. Modal, Toast, Panel ve Dialog */
.modal {
    position: fixed;
    inset: 0;
    z-index: 1000;
    background: var(--modal-bg);
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: var(--modal-blur);
    transition: opacity .3s;
}
.modal.active { display: flex; }
.modal-content {
    background: #fff;
    color: #222;
    border-radius: 16px;
    padding: 2.2em 2.2em 1.7em 2.2em;
    box-shadow: var(--shadow-strong);
    min-width: 270px;
    max-width: 97vw;
    text-align: center;
    animation: fadeIn 0.4s;
    font-size: 1.12rem;
    position: relative;
}
.modal-content h2 { margin-bottom: 1.4rem; font-size: 1.5rem;}
.toast {
    position: fixed;
    left: 50%;
    bottom: 24px;
    transform: translateX(-50%);
    background: var(--toast-bg);
    color: var(--toast-color);
    padding: 0.9em 2em;
    border-radius: 9px;
    font-size: 1.08rem;
    box-shadow: 0 2px 10px #0005;
    opacity: 0;
    pointer-events: none;
    z-index: 1200;
    transition: opacity 0.32s;
}
.toast.show { opacity: 1; pointer-events: all;}
.success-toast {
    background: var(--win);
    color: #fff;
}
@keyframes fadeIn { 0% { opacity: 0; } 100% { opacity: 1; } }
.hidden { display: none !important; }

/* 9. Setup/Settings/Rehber Paneli */
.setup-step, .form-group {
    margin: 1.1em 0 .9em 0;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}
.setup-step label, .form-group label {
    font-weight: 600;
    font-size: 1.07rem;
    margin-bottom: 0.6em;
    color: var(--accent-dark);
}
.setup-step input[type="text"], .form-group input[type="text"],
.setup-step select, .form-group select {
    font-size: 1.05rem;
    padding: 0.5em 1em;
    border-radius: 7px;
    border: 1.5px solid var(--accent);
    outline: none;
    margin-bottom: 0.3em;
    width: 100%;
    min-width: 140px;
    transition: border .13s;
}
.setup-step input[type="checkbox"], .form-group input[type="checkbox"] {
    margin-right: .6em;
    accent-color: var(--accent);
}
.level-buttons {
    display: flex;
    gap: 1.2rem;
    margin-bottom: 0.8rem;
    width: 100%;
}
.level-btn {
    background: var(--header-bg);
    border: 2.5px solid var(--accent);
    color: var(--header-text);
    font-size: 1.09rem;
    padding: 0.7em 2.1em;
    border-radius: 7px;
    cursor: pointer;
    font-weight: bold;
    transition: background .18s, color .18s, border .18s;
    margin-bottom: 2px;
}
.level-btn.selected,
.level-btn:active {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent-dark);
}
.start-btn {
    font-size: 1.08rem;
    padding: 0.72em 2.8em;
    border-radius: 8px;
    background: var(--win);
    color: #fff;
    font-weight: 700;
    border: none;
    margin-top: 1.3rem;
    cursor: pointer;
    box-shadow: 0 4px 16px #0003;
    transition: background 0.19s;
}
.start-btn:active { background: #189048;}
/* Rehber */
.guide-content, .settings-content {
    text-align: left;
    max-width: 460px;
    min-width: 230px;
    padding: 2.2em 1.5em 1.5em 1.5em;
}
.guide-content h3 {
    margin: 1.2em 0 0.5em 0;
    color: var(--accent-dark);
    font-size: 1.09rem;
}
.guide-content p {
    margin-bottom: 0.7em;
    font-size: 1.01rem;
    color: #342f3b;
}
#closeGuideBtn, #closeSettingsBtn {
    margin-top: 1.1em;
}

/* 10. Terfi Paneli (Pawn Promotion) */
.promotion-panel {
    position: absolute;
    z-index: 100;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%);
    background: #fff;
    box-shadow: 0 6px 24px #2226;
    border-radius: 12px;
    padding: 1.5em 2.1em;
    text-align: center;
    transition: opacity 0.2s, visibility 0.2s;
}
.promotion-panel.hidden { display: none; }
.promotion-panel h3 {
    margin-bottom: 1.1em;
    color: var(--accent-dark);
    font-size: 1.2rem;
    font-weight: bold;
}
.promotion-options {
    display: flex;
    gap: 1.3em;
    justify-content: center;
    margin-bottom: 0.7em;
}
.promo-btn {
    font-size: 2.3rem;
    background: #ececec;
    border: 2.5px solid var(--accent);
    color: var(--accent-dark);
    cursor: pointer;
    border-radius: 8px;
    width: 54px;
    height: 54px;
    transition: background .14s, color .14s, border .14s;
}
.promo-btn:hover,
.promo-btn:focus {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent-dark);
    outline: none;
}

@media (max-width: 480px) {
    .promotion-panel {
        min-width: 145px;
        padding: 1.2em 0.6em;
    }
    .promo-btn { width: 37px; height: 37px; font-size: 1.1rem;}
}

/* 11. Sonu√ß/Kazanma Modalƒ± */
#resultModal .modal-content {
    border: 2.5px solid var(--accent);
    background: #fff;
    color: #1c1c1c;
    text-align: center;
    font-size: 1.18rem;
    min-width: 240px;
    max-width: 99vw;
    padding: 2.1em 2em 2em 2em;
}
#resultModal h2 {
    font-size: 2.6rem;
    margin-bottom: 0.6em;
    letter-spacing: 2px;
}
#resultDetails {
    margin-bottom: 1.3em;
    font-size: 1.09rem;
    color: #555;
}
#resultModal .start-btn {
    background: var(--accent);
    font-size: 1.13rem;
    margin-top: 1.2em;
}
#resultModal .start-btn:active {
    background: var(--accent-dark);
}

/* 12. Ayarlar Paneli */
.settings-content h2 { margin-bottom: 1.1em; }
#settingsForm {
    display: flex;
    flex-direction: column;
    gap: 1.2em;
}
.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.3em;
}
#settingsForm select, #settingsForm input[type="checkbox"] {
    font-size: 1.02rem;
    padding: 0.5em 1em;
    border-radius: 5px;
    border: 1.5px solid var(--accent);
    outline: none;
    margin-bottom: 0.2em;
    transition: border .16s;
}
#settingsForm input[type="checkbox"] {
    width: 20px;
    height: 20px;
    accent-color: var(--accent);
    margin-right: .7em;
}
#settingsForm button {
    margin-top: 1em;
}

/* 13. Footer ve Ekstra Linkler */
footer {
    background: var(--footer-bg);
    color: var(--footer-text);
    text-align: center;
    padding: 0.7rem 0 0.3rem 0;
    font-size: 1.01rem;
    letter-spacing: 0.6px;
    border-top: 1.5px solid #292a36;
    box-shadow: 0 -2px 8px #0002;
}
.footer-links {
    margin-top: 0.5em;
    font-size: .97rem;
}
.footer-links a {
    color: var(--accent);
    text-decoration: underline;
    margin: 0 0.5em;
    transition: color .17s;
}
.footer-links a:hover { color: var(--accent-dark); }

/* 14. Temalar (Koyu, Modern, Cam vb) */
body.dark-theme {
    --background: #171824;
    --header-bg: #14151e;
    --header-text: #d2e9ff;
    --footer-bg: #181b24;
    --footer-text: #d6e2ea;
    --accent: #7fbfff;
    --accent-dark: #2666a3;
    --cell-dark: #222634;
    --cell-light: #5c6a82;
    --board-shadow: 0 8px 32px #0015;
    --modal-bg: rgba(12,14,24,0.95);
    background: var(--background);
    color: #f7f7fe;
}
body.modern-theme {
    --cell-dark: #4b4e6d;
    --cell-light: #e5e9f7;
    --accent: #e9446a;
    --accent-dark: #b12f4b;
    --header-bg: #2b2e3a;
    --footer-bg: #2b2e3a;
    --footer-text: #e5e8ff;
}
body.glass-theme {
    backdrop-filter: blur(8px);
    --cell-dark: #2228;
    --cell-light: #fff5;
    --board-shadow: 0 8px 32px #eee7;
    --modal-bg: rgba(255,255,255,0.72);
    --header-bg: #f8fafd99;
    --footer-bg: #f8fafd99;
    --footer-text: #23242b;
}

/* 15. Animasyonlar ve Detaylar */
.chess-cell {
    transition: background 0.22s, box-shadow 0.18s, outline .13s, filter .13s;
    will-change: background, box-shadow, outline;
}
.chess-cell.moveable, .chess-cell.capture, .chess-cell.last-move, .chess-cell.highlight {
    animation: cellFlash 0.45s linear;
}
@keyframes cellFlash {
    0% { filter: brightness(1.15); }
    100% { filter: brightness(1.0);}
}
.modal-content, .promotion-panel {
    animation: fadeIn .32s;
}

/* 16. Scrollbar ve Mobil Adaptasyon */
::-webkit-scrollbar {
    width: 9px;
    background: #e9ecf2;
}
::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 10px;
}
@media (max-width: 340px) {
    .move-history, #chessBoardContainer { max-width: 99vw;}
    .modal-content, .promotion-panel { min-width: 90vw; }
    .guide-content, .settings-content { min-width: 80vw;}
}

/* 17. Eri≈üilebilirlik ve Focus */
a, button, select, input[type="text"] {
    transition: outline .14s, box-shadow .14s;
}
a:focus, button:focus, select:focus, input[type="text"]:focus {
    outline: 2.5px solid var(--accent);
    box-shadow: 0 0 0 3px var(--accent-dark), 0 0 2px #0002;
}

/* 18. Ekstra Detaylar */
@media (max-width: 340px) {
    .site-title { font-size: 1.01rem;}
    .player-info-bar, .move-history { font-size: .75rem;}
}
@media (max-width: 420px) {
    .modal-content, .promotion-panel { padding: 1em 0.1em;}
}

@media (max-width: 350px) {
    .site-header .site-logo { width: 24px; height: 24px;}
    .site-title { font-size: .8rem;}
}
/* Dosya sonu -- style.css, birle≈ütirilmi≈ü ve optimize */</style></head> 
 <body> <!-- HEADER --> 
  <header class="site-header" aria-label="Site √ústbilgisi"> 
   <img src="Hƒ∞GER_20250317_154048_0000.png" alt="HIGER Logo" class="site-logo"> 
   <h1 class="site-title">HIGER Satran√ß AI Platformu</h1> 
   <nav class="site-nav" aria-label="Ana Men√º"> 
    <ul> 
     <li><a href="#" class="active" id="navGame">Oyun</a></li> 
     <li><a href="#" id="navGuide">Rehber</a></li> 
     <li><a href="#" id="navSettings">Ayarlar</a></li> 
     <li><a href="https://github.com/Higer23/Chess" target="_blank" rel="noopener">GitHub</a></li> 
    </ul> 
   </nav> <button id="themeToggle" class="theme-toggle-btn" aria-label="Tema Deƒüi≈ütir"></button> <select id="languageSelect" aria-label="Dil Se√ßimi"> <option value="tr" selected>TR</option> <option value="en">EN</option> </select> 
  </header> <!-- ANA G√ñVDE --> 
  <main id="mainContent"> <!-- Oyuna Hazƒ±rlƒ±k Paneli --> 
   <section id="setupSection" class="modal active" tabindex="-1" aria-modal="true" aria-labelledby="setupSectionTitle"> 
    <div class="modal-content"> 
     <h2 id="setupSectionTitle">Oyuna Ba≈üla</h2> 
     <div class="setup-steps"> 
      <div class="setup-step"> <label for="playerName">Adƒ±nƒ±z:</label> 
       <input type="text" id="playerName" maxlength="20" placeholder="Oyuncu Adƒ± (isteƒüe baƒülƒ±)"> 
      </div> 
      <div class="setup-step"> <label for="themeSelect">Tema:</label> <select id="themeSelect"> <option value="classic">Klasik</option> <option value="modern">Modern</option> <option value="dark">Koyu</option> <option value="glass">Cam</option> </select> 
      </div> 
      <div class="setup-step"> <label for="soundToggle">Ses Efektleri:</label> 
       <input type="checkbox" id="soundToggle" checked> 
      </div> 
      <div class="setup-step"> <label>Zorluk Se√ßimi:</label> 
       <div class="level-buttons"> <button class="level-btn" data-level="easy">Kolay</button> <button class="level-btn" data-level="medium">Orta</button> <button class="level-btn" data-level="hard">Zor</button> <button class="level-btn" data-level="master">Usta</button> 
       </div> 
      </div> 
      <div class="setup-step"> <label for="sideSelect">Taraf:</label> <select id="sideSelect"> <option value="white">Beyaz</option> <option value="black">Siyah</option> <option value="random">Rastgele</option> </select> 
      </div> 
     </div> <button id="startGameBtn" class="start-btn" disabled>Ba≈üla</button> 
    </div> 
   </section> <!-- Oyun Alanƒ± --> 
   <section id="gameSection" class="hidden" aria-label="Satran√ß Alanƒ±"> 
    <div class="controls-top"> <button id="undoBtn" class="ctrl-btn" aria-label="Geri Al"><span class="ctrl-icon">‚Ü∂</span> Geri Al</button> <button id="resetBtn" class="ctrl-btn" aria-label="Yeniden Ba≈ülat"><span class="ctrl-icon">‚Ü∫</span> Yeni Oyun</button> <button id="aiBtn" class="ctrl-btn" aria-label="AI Hamlesi"><span class="ctrl-icon">ü§ñ</span> AI Oyna</button> <button id="fenBtn" class="ctrl-btn" aria-label="FEN Kopyala"><span class="ctrl-icon">üìã</span> FEN Kopyala</button> <button id="settingsBtn" class="ctrl-btn" aria-label="Oyun Ayarlarƒ±"><span class="ctrl-icon">‚öô</span> Ayarlar</button> 
    </div> 
    <div class="player-info-bar" aria-label="Oyuncu ve AI Bilgileri"> <span id="playerWhite" class="player-label"><span class="player-dot white"></span> <span class="player-name"></span></span> <span id="turnIndicator" class="turn-indicator"></span> <span id="playerBlack" class="player-label"><span class="player-dot black"></span> <span class="player-name"></span></span> 
    </div> 
    <div id="chessBoardContainer"> 
     <div id="chessBoard"></div> <!-- Ta≈ü Terfi Paneli --> 
     <div id="promotionPanel" class="promotion-panel hidden" aria-label="Terfi Paneli" tabindex="-1"> 
      <h3>Terfi Et!</h3> 
      <div class="promotion-options"> <button class="promo-btn" data-piece="Q">‚ôï</button> <button class="promo-btn" data-piece="R">‚ôñ</button> <button class="promo-btn" data-piece="B">‚ôó</button> <button class="promo-btn" data-piece="N">‚ôò</button> 
      </div> 
     </div> 
    </div> 
    <div id="moveHistory" class="move-history"></div> 
    <div class="controls-bottom"> <button id="hintBtn" class="ctrl-btn" aria-label="Hamle ƒ∞pucu"><span class="ctrl-icon">üí°</span> ƒ∞pucu</button> <button id="exportPGNBtn" class="ctrl-btn" aria-label="PGN Dƒ±≈üa Aktar"><span class="ctrl-icon">üíæ</span> PGN Kaydet</button> <button id="shareBtn" class="ctrl-btn" aria-label="Payla≈ü"><span class="ctrl-icon">üîÅ</span> Payla≈ü</button> 
    </div> 
   </section> <!-- Oyun Sonu Modalƒ± --> 
   <section id="resultModal" class="modal" tabindex="-1" aria-modal="true" aria-labelledby="resultMessage"> 
    <div class="modal-content"> 
     <h2 id="resultMessage"></h2> 
     <div id="resultDetails"></div> <button id="restartBtn" class="start-btn">Yeniden Ba≈ülat</button> 
    </div> 
   </section> <!-- Rehber Paneli --> 
   <section id="guideSection" class="modal" tabindex="-1" aria-modal="true" aria-labelledby="guideSectionTitle"> 
    <div class="modal-content guide-content"> 
     <h2 id="guideSectionTitle">Satran√ß Rehberi &amp; SSS</h2> 
     <div id="guideBody"> <!-- Dinamik olarak JS ile doldurulacak --> 
     </div> <button id="closeGuideBtn" class="ctrl-btn">Kapat</button> 
    </div> 
   </section> <!-- Ayarlar Paneli --> 
   <section id="settingsSection" class="modal" tabindex="-1" aria-modal="true" aria-labelledby="settingsSectionTitle"> 
    <div class="modal-content settings-content"> 
     <h2 id="settingsSectionTitle">Ayarlar</h2> 
     <form id="settingsForm"> 
      <div class="form-group"> <label for="langSettings">Dil:</label> <select id="langSettings"> <option value="tr">T√ºrk√ße</option> <option value="en">English</option> </select> 
      </div> 
      <div class="form-group"> <label for="themeSettings">Tema:</label> <select id="themeSettings"> <option value="classic">Klasik</option> <option value="modern">Modern</option> <option value="dark">Koyu</option> <option value="glass">Cam</option> </select> 
      </div> 
      <div class="form-group"> <label>Ses Efektleri:</label> 
       <input type="checkbox" id="soundSettings"> 
      </div> 
      <div class="form-group"> <label for="animationSettings">Animasyonlar:</label> 
       <input type="checkbox" id="animationSettings" checked> 
      </div> <button type="submit" class="ctrl-btn">Kaydet</button> 
     </form> <button id="closeSettingsBtn" class="ctrl-btn">Kapat</button> 
    </div> 
   </section> <!-- Toast Bilgilendirme --> 
   <section id="errorToast" class="toast" aria-live="polite" aria-atomic="true"></section> 
   <section id="successToast" class="toast success-toast" aria-live="polite" aria-atomic="true"></section> 
  </main> <!-- FOOTER --> 
  <footer> 
   <p>¬© 2025 HIGER Satran√ß ‚Äî Geli≈ümi≈ü Chess AI, Mobil ve Masa√ºst√º Uyum, √áoklu Dil ve Tema</p> 
   <p class="footer-links"> <a href="https://github.com/Higer23/Chess" target="_blank" rel="noopener">GitHub</a> | <a href="#guideSection" id="footerGuideLink">Rehber</a> </p> 
  </footer> <!-- Eri≈üilebilirlik i√ßin ARIA ve tabindex kullanƒ±mlarƒ±na dikkat edildi. --> 
  <script>
    // Eri≈üilebilirlik: Tab ile modal ve men√ºlerin odakta kalmasƒ±nƒ± saƒülar.
    document.addEventListener('keydown', function(e) {
        if (e.key === "Tab") {
            const modals = document.querySelectorAll(".modal.active");
            if (modals.length) {
                const focusables = modals[0].querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                if (!focusables.length) return;
                let first = focusables[0];
                let last = focusables[focusables.length - 1];
                if (e.shiftKey) {
                    if (document.activeElement === first) {
                        last.focus();
                        e.preventDefault();
                    }
                } else {
                    if (document.activeElement === last) {
                        first.focus();
                        e.preventDefault();
                    }
                }
            }
        }
    });
    </script> <!-- Kullanƒ±cƒ± rehberi i√ßeriƒüi: --> 
  <script type="application/json" id="guideJSON">
    {
        "tr": [
            {
                "title": "Oyun Ba≈ülatma",
                "content": "Ba≈ülamak i√ßin adƒ±nƒ±zƒ± (isteƒüe baƒülƒ±), tema, ses ve zorluk se√ßin. 'Ba≈üla'ya tƒ±klayƒ±n."
            },
            {
                "title": "Ta≈ü Hareketleri",
                "content": "Bir ta≈üƒ± se√ßmek i√ßin dokunun veya tƒ±klayƒ±n. Gitmek istediƒüiniz kareyi se√ßin. Ge√ßerli hamleler vurgulanƒ±r."
            },
            {
                "title": "AI ile Oynamak",
                "content": "AI'nƒ±n hamle yapmasƒ±nƒ± istiyorsanƒ±z 'AI Oyna'ya tƒ±klayƒ±n. Zorluk seviyesini oyun ba≈üƒ±nda se√ßebilirsiniz."
            },
            {
                "title": "Terfi",
                "content": "Piyon son sƒ±raya ula≈ütƒ±ƒüƒ±nda, a√ßƒ±lan panelden istediƒüiniz ta≈üƒ± se√ßin."
            },
            {
                "title": "Geri Al & Yeni Oyun",
                "content": "'Geri Al' ile bir √∂nceki hamleye d√∂nebilir, 'Yeni Oyun' ile sƒ±fƒ±rdan ba≈ülayabilirsiniz."
            },
            {
                "title": "FEN ve PGN",
                "content": "FEN ile mevcut konumu kopyalayabilir, PGN ile oyunu kaydedebilirsiniz."
            }
        ],
        "en": [
            {
                "title": "Start the Game",
                "content": "Enter your name (optional), choose theme, sound, and difficulty. Click 'Start'."
            },
            {
                "title": "Moving Pieces",
                "content": "Click or tap a piece to select it, then click a square to move. Valid moves are highlighted."
            },
            {
                "title": "Playing with AI",
                "content": "To let the AI move, click 'AI Move'. You can set the difficulty before starting the game."
            },
            {
                "title": "Promotion",
                "content": "When a pawn reaches the last rank, choose the piece for promotion on the panel."
            },
            {
                "title": "Undo & New Game",
                "content": "Use 'Undo' to revert your last move, 'New Game' to start afresh."
            },
            {
                "title": "FEN and PGN",
                "content": "Copy current position with FEN, or save the game with PGN export."
            }
        ]
    }
    </script> 
  <script>
    // Tema ve dil hƒ±zlƒ± ayarlarƒ± (body class)
    document.getElementById("themeToggle").addEventListener("click", function() {
        document.body.classList.toggle("dark-theme");
        localStorage.setItem("theme", document.body.classList.contains("dark-theme") ? "dark" : "light");
    });
    // Dil se√ßimi
    document.getElementById("languageSelect").addEventListener("change", function() {
        const lang = this.value;
        localStorage.setItem("lang", lang);
        applyLanguage(lang);
    });
    function applyLanguage(lang) {
        document.documentElement.lang = lang;
    }
    // Men√º baƒülantƒ±larƒ± (Rehber, Ayarlar)
    document.getElementById("navGuide").addEventListener("click", function(e) {
        e.preventDefault();
        openGuide();
    });
    function openGuide() {
        let guide = document.getElementById("guideSection");
        guide.classList.add("active");
        let lang = localStorage.getItem("lang") || "tr";
        let data = JSON.parse(document.getElementById("guideJSON").textContent)[lang] || [];
        let html = "";
        data.forEach(item => {
            html += `<h3>${item.title}</h3><p>${item.content}</p>`;
        });
        document.getElementById("guideBody").innerHTML = html;
        document.getElementById("closeGuideBtn").focus();
    }
    document.getElementById("closeGuideBtn").addEventListener("click", function() {
        document.getElementById("guideSection").classList.remove("active");
    });
    document.getElementById("footerGuideLink").onclick = function(e) {
        e.preventDefault();
        openGuide();
    };
    // Ayarlar panelini a√ß/kapat
    document.getElementById("navSettings").addEventListener("click", function(e) {
        e.preventDefault();
        document.getElementById("settingsSection").classList.add("active");
        document.getElementById("themeSettings").value = localStorage.getItem("theme") || "classic";
    });
    document.getElementById("settingsBtn").onclick = function() {
        document.getElementById("settingsSection").classList.add("active");
    };
    document.getElementById("closeSettingsBtn").onclick = function() {
        document.getElementById("settingsSection").classList.remove("active");
    };
    document.getElementById("settingsForm").onsubmit = function(e) {
        e.preventDefault();
        let lang = document.getElementById("langSettings").value;
        let theme = document.getElementById("themeSettings").value;
        let sound = document.getElementById("soundSettings").checked;
        let anim = document.getElementById("animationSettings").checked;
        localStorage.setItem("lang", lang);
        localStorage.setItem("theme", theme);
        localStorage.setItem("sound", sound);
        localStorage.setItem("anim", anim);
        applyLanguage(lang);
        document.getElementById("settingsSection").classList.remove("active");
        document.getElementById("successToast").innerText = "Ayarlar kaydedildi!";
        document.getElementById("successToast").classList.add("show");
        setTimeout(()=>document.getElementById("successToast").classList.remove("show"), 1800);
    };
    (function(){
        let theme = localStorage.getItem("theme");
        if (theme === "dark") document.body.classList.add("dark-theme");
    })();
    (function(){
        let lang = localStorage.getItem("lang");
        if (lang) {
            document.getElementById("languageSelect").value = lang;
            applyLanguage(lang);
        }
    })();
    // Escape ile modal kapama, F1 rehber, Ctrl+Z geri al
    document.addEventListener('keydown', function(e) {
        if (e.key === "Escape") {
            let openModals = document.querySelectorAll(".modal.active");
            openModals.forEach(modal => {
                if (!modal.id.startsWith("setup")) modal.classList.remove("active");
            });
        }
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "z") {
            if (!document.getElementById("setupSection").classList.contains("active") &&
                !document.getElementById("resultModal").classList.contains("active")) {
                document.getElementById("undoBtn").click();
            }
        }
        if (e.key === "F1") {
            e.preventDefault();
            openGuide();
        }
    });
    // Web Share API (Mobil i√ßin)
    document.getElementById("shareBtn").onclick = function() {
        let fen = window.fenFromBoard ? window.fenFromBoard() : "";
        let url = window.location.href;
        let msg = "HIGER Satran√ß'ta konumum:\n" + fen + "\n" + url;
        if (navigator.share) {
            navigator.share({
                title: "HIGER Chess",
                text: msg,
                url: url
            });
        } else {
            navigator.clipboard.writeText(msg);
            document.getElementById("successToast").innerText = "Payla≈üƒ±m panoya kopyalandƒ±!";
            document.getElementById("successToast").classList.add("show");
            setTimeout(()=>document.getElementById("successToast").classList.remove("show"), 1800);
        }
    };
    // PGN ƒ∞hracƒ±
    document.getElementById("exportPGNBtn").onclick = function() {
        if (!window.getPGN) {
            document.getElementById("errorToast").innerText = "PGN olu≈üturulamƒ±yor!";
            document.getElementById("errorToast").classList.add("show");
            setTimeout(()=>document.getElementById("errorToast").classList.remove("show"), 1800);
            return;
        }
        let pgn = window.getPGN();
        let blob = new Blob([pgn], {type: "text/plain"});
        let url = URL.createObjectURL(blob);
        let a = document.createElement('a');
        a.href = url;
        a.download = "higer-chess.pgn";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        document.getElementById("successToast").innerText = "PGN dƒ±≈üa aktarƒ±ldƒ±!";
        document.getElementById("successToast").classList.add("show");
        setTimeout(()=>document.getElementById("successToast").classList.remove("show"), 1800);
    };
    // Hint (Hamle √∂nerisi)
    document.getElementById("hintBtn").onclick = function() {
        if (window.getHintMove) {
            let move = window.getHintMove();
            if (move && typeof move.from === "number" && typeof move.to === "number") {
                let cells = document.querySelectorAll(".chess-cell");
                cells[move.from].classList.add("highlight");
                cells[move.to].classList.add("highlight");
                document.getElementById("successToast").innerText = "ƒ∞pucu: " + move.notation;
                document.getElementById("successToast").classList.add("show");
                setTimeout(()=>{
                    document.getElementById("successToast").classList.remove("show");
                    cells[move.from].classList.remove("highlight");
                    cells[move.to].classList.remove("highlight");
                }, 2600);
            }
        } else {
            document.getElementById("errorToast").innerText = "ƒ∞pucu √∂zelliƒüi hazƒ±r deƒüil.";
            document.getElementById("errorToast").classList.add("show");
            setTimeout(()=>document.getElementById("errorToast").classList.remove("show"), 1800);
        }
    };
    // PWA Manifest ekle
    (function(){
        let link = document.createElement("link");
        link.rel = "manifest";
        link.href = "manifest.json";
        document.head.appendChild(link);
    })();
    </script> 
  <script src="chess.js"></script> 
 
<script type="text/javascript" id="dcoder_script">// HIGER Satran√ß AI Platformu - T√ºm JS Birle≈ütirilmi≈ü (Yakla≈üƒ±k 700+ satƒ±r, mod√ºler, eri≈üilebilir)

/**
 * HIGER Satran√ß AI Platformu
 * - Geli≈ümi≈ü: √áoklu AI zorluƒüu, tema, ses, animasyon, √ßoklu dil, PGN/FEN, eri≈üilebilirlik, mobil uyum
 * - Yazar: Higer23
 * - 2025-06
 */

// -------- GLOBAL SABƒ∞TLER VE DEƒûƒ∞≈ûKENLER --------
const PIECES = {
    wK: "‚ôî", wQ: "‚ôï", wR: "‚ôñ", wB: "‚ôó", wN: "‚ôò", wP: "‚ôô",
    bK: "‚ôö", bQ: "‚ôõ", bR: "‚ôú", bB: "‚ôù", bN: "‚ôû", bP: "‚ôü"
};
const PIECE_VALUES = { K: 900, Q: 90, R: 50, B: 30, N: 30, P: 10 };
const AI_LEVELS = {
    easy:   { name: "Kolay",   depth: 1, randomness: 0.60, desc: "Ba≈ülangƒ±√ß seviyesi, hƒ±zlƒ± ve rastgele." },
    medium: { name: "Orta",    depth: 2, randomness: 0.22, desc: "Dengeli, yeni ba≈ülayanlar i√ßin ideal." },
    hard:   { name: "Zor",     depth: 3, randomness: 0.04, desc: "Tecr√ºbeli oyunculara uygun, az rastgele." },
    master: { name: "Usta",    depth: 4, randomness: 0.00, desc: "AI hata yapmaz, en iyi seviye." }
};
const THEMES = ["classic", "modern", "dark", "glass"];
const LANGS = ["tr", "en"];
const SIDES = ["white", "black", "random"];
const PROMOTION_PIECES = ["Q", "R", "B", "N"];
const startPos = [
    "bR","bN","bB","bQ","bK","bB","bN","bR",
    "bP","bP","bP","bP","bP","bP","bP","bP",
    "","","","","","","","",
    "","","","","","","","",
    "","","","","","","","",
    "","","","","","","","",
    "wP","wP","wP","wP","wP","wP","wP","wP",
    "wR","wN","wB","wQ","wK","wB","wN","wR"
];
// Oyun deƒüi≈ükenleri
let board = [...startPos];
let selected = null;
let moveableSquares = [];
let moveHistory = [];
let historyBoards = [];
let lastMove = null;
let turn = "w";
let gameOver = false;
let aiLevel = "easy";
let aiDepth = AI_LEVELS[aiLevel].depth;
let aiRandomness = AI_LEVELS[aiLevel].randomness;
let aiLocked = false;
let userSide = "white";
let playerNames = { w: "Beyaz", b: "Siyah" };
let gameResult = null;
let promotionCallback = null;
let animationsEnabled = true;
let soundEnabled = true;

// UI eleman referanslarƒ±
const $ = (id) => document.getElementById(id);
const chessBoard = $("chessBoard");
const moveHistoryDiv = $("moveHistory");
const undoBtn = $("undoBtn");
const resetBtn = $("resetBtn");
const aiBtn = $("aiBtn");
const fenBtn = $("fenBtn");
const resultModal = $("resultModal");
const errorToast = $("errorToast");
const successToast = $("successToast");
const setupSection = $("setupSection");
const gameSection = $("gameSection");
const promotionPanel = $("promotionPanel");
const playerWhite = $("playerWhite");
const playerBlack = $("playerBlack");
const turnIndicator = $("turnIndicator");

// ----------- YARDIMCI FONKSƒ∞YONLAR -----------
function posToRC(i) { return [Math.floor(i/8), i%8]; }
function rcToPos(r,c) { return r*8 + c; }
function isSameColor(piece, color) { return piece && piece[0] === color; }
function isOppColor(piece, color) { return piece && piece[0] !== color; }
function algebraic(i) { return "abcdefgh"[i%8] + (8 - Math.floor(i/8)); }
function colorName(s) { return s==="w" ? getText("white") : getText("black"); }
function opponent(t) { return t==="w" ? "b" : "w"; }
function getText(key) {
    // Basit dil desteƒüi √∂rneƒüi, geni≈ületilebilir
    let texts = {
        "tr": {
            "white": "Beyaz", "black": "Siyah", "draw": "Berabere", "win": "Kazandƒ±nƒ±z!", "lose": "Kaybettiniz!",
            "aiMoveBlocked": "AI bu durumda oynayamaz.",
            "noUndo": "Geri alacak hamle yok.",
            "noPGN": "PGN kaydedilemedi.",
            "fenCopied": "FEN panoya kopyalandƒ±!",
            "settingsSaved": "Ayarlar kaydedildi!",
            "promotion": "Terfi Et!",
            "startError": "Oyun ba≈ülatƒ±lamadƒ±, l√ºtfen t√ºm ayarlarƒ± kontrol edin."
        },
        "en": {
            "white": "White", "black": "Black", "draw": "Draw", "win": "You win!", "lose": "You lose!",
            "aiMoveBlocked": "AI cannot move now.",
            "noUndo": "No move to undo.",
            "noPGN": "PGN export error.",
            "fenCopied": "FEN copied to clipboard!",
            "settingsSaved": "Settings saved!",
            "promotion": "Promote Pawn!",
            "startError": "Cannot start game, check all settings."
        }
    };
    let lang = localStorage.getItem("lang") || "tr";
    return (texts[lang] && texts[lang][key]) ? texts[lang][key] : key;
}
function showToast(msg, type="error") {
    let toast = type==="success" ? successToast : errorToast;
    toast.innerText = msg;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 2200);
}
function playSound(type="move") {
    if (!soundEnabled) return;
    let src = "";
    switch(type) {
        case "move": src = "sounds/move.mp3"; break;
        case "capture": src = "sounds/capture.mp3"; break;
        case "win": src = "sounds/win.mp3"; break;
        case "lose": src = "sounds/lose.mp3"; break;
        case "draw": src = "sounds/draw.mp3"; break;
        case "promote": src = "sounds/promote.mp3"; break;
    }
    if (!src) return;
    let a = new Audio(src);
    a.volume = 0.20;
    a.play();
}
function setTheme(theme) {
    THEMES.forEach(t => document.body.classList.remove(t+"-theme"));
    document.body.classList.add(theme+"-theme");
    localStorage.setItem("theme", theme);
}
function setLanguage(lang) {
    localStorage.setItem("lang", lang);
    // UI metinleri dinamik olarak g√ºncellenebilir.
}

function loadUserPrefs() {
    let theme = localStorage.getItem("theme") || "classic";
    setTheme(theme);
    let lang = localStorage.getItem("lang") || "tr";
    setLanguage(lang);
    soundEnabled = (localStorage.getItem("sound") !== "false");
    animationsEnabled = (localStorage.getItem("anim") !== "false");
    let pn = localStorage.getItem("playerName");
    if (pn) $("playerName").value = pn;
}

function saveUserPrefs() {
    localStorage.setItem("sound", soundEnabled);
    localStorage.setItem("anim", animationsEnabled);
    localStorage.setItem("playerName", $("playerName").value);
}

// ----------- OYUN BA≈ûLATMA & SETUP -----------
function setupGame() {
    // Oyun ba≈ülatma panelinde se√ßimleri uygula
    let pname = $("playerName").value.trim();
    if (pname) playerNames.w = pname;
    else playerNames.w = getText("white");
    playerNames.b = "AI";
    // Zorluk
    let levelBtn = document.querySelector(".level-btn.selected");
    aiLevel = levelBtn ? levelBtn.dataset.level : "easy";
    aiDepth = AI_LEVELS[aiLevel].depth;
    aiRandomness = AI_LEVELS[aiLevel].randomness;
    // Taraf
    userSide = $("sideSelect").value;
    if (userSide === "random") userSide = Math.random() > 0.5 ? "white" : "black";
    // Tema
    let theme = $("themeSelect").value;
    setTheme(theme);
    // Ses
    soundEnabled = $("soundToggle").checked;
    saveUserPrefs();
    // Oyun ba≈ülat
    resetBoard();
    setupSection.classList.remove("active");
    gameSection.classList.remove("hidden");
    updatePlayerBar();
    if ((userSide === "black" && turn === "w") || (userSide === "white" && turn === "b")) {
        setTimeout(autoAIMoveIfNeeded, 500);
    }
}

// ----------- OYUN TAHTASI √áƒ∞Zƒ∞Mƒ∞ -----------
function drawBoard() {
    chessBoard.innerHTML = "";
    for (let i = 0; i < 64; i++) {
        const cell = document.createElement("div");
        cell.className = "chess-cell " + (((Math.floor(i/8)+i)%2===0) ? "light" : "dark");
        if (selected === i) cell.classList.add("selected");
        if (moveableSquares.includes(i)) cell.classList.add("moveable");
        if (lastMove && (lastMove.from===i || lastMove.to===i)) cell.classList.add("last-move");
        if (isCheck(turn==="w"?"b":"w") && board[i] && board[i][1]==="K" && board[i][0]!==turn)
            cell.classList.add("check");
        cell.innerText = PIECES[board[i]] || "";
        cell.setAttribute('tabindex', 0);
        cell.setAttribute('aria-label', (board[i] ? PIECES[board[i]] + " " : "") + algebraic(i));
        cell.onclick = ()=>handleCellClick(i);
        chessBoard.appendChild(cell);
    }
    drawHistory();
    aiBtn.style.display = (turn==="b"&&!gameOver) ? "inline-block" : "none";
    undoBtn.disabled = moveHistory.length === 0 || gameOver;
    fenBtn.disabled = gameOver;
    updatePlayerBar();
}
function updatePlayerBar() {
    playerWhite.querySelector(".player-name").innerText = playerNames.w || getText("white");
    playerBlack.querySelector(".player-name").innerText = playerNames.b || getText("black");
    turnIndicator.innerText = (turn==="w" ? "‚¨Ö" : "‚û°") + " " + colorName(turn) + " " + (turn==="w" ? "oynuyor" : "moves");
    turnIndicator.style.background = turn==="w" ? "#aeefff" : "#ffe4ae";
}

// ----------- HAMLE GE√áMƒ∞≈ûƒ∞ -----------
function drawHistory() {
    moveHistoryDiv.innerHTML = "";
    moveHistory.forEach((m, i) => {
        const el = document.createElement("span");
        el.className = "move" + ((i === moveHistory.length-1) ? " selected" : "");
        el.innerText = m.notation;
        el.onclick = ()=>jumpToMove(i);
        moveHistoryDiv.appendChild(el);
    });
}

// ------ TA≈û SE√áƒ∞Mƒ∞ VE HAMLELER ------
function handleCellClick(idx) {
    if (gameOver || aiLocked) return;
    if ((userSide === "white" && turn !== "w") || (userSide === "black" && turn !== "b")) return;
    if (selected !== null && moveableSquares.includes(idx)) {
        // Terfi kontrol√º
        if (board[selected][1]==="P" && (Math.floor(idx/8)===0 || Math.floor(idx/8)===7)) {
            showPromotionPanel(selected, idx, board[selected][0]);
        } else {
            makeMove(selected, idx, true);
            selected = null;
            moveableSquares = [];
            drawBoard();
            if (!gameOver) setTimeout(autoAIMoveIfNeeded, 480);
        }
        return;
    }
    if (board[idx] && isSameColor(board[idx], turn)) {
        selected = idx;
        moveableSquares = legalMoves(idx);
        drawBoard();
    } else {
        selected = null;
        moveableSquares = [];
        drawBoard();
    }
}

// --- PROMOSYON PANELƒ∞ ---
function showPromotionPanel(from, to, color) {
    promotionPanel.classList.remove("hidden");
    let opts = promotionPanel.querySelectorAll(".promo-btn");
    opts.forEach(btn => {
        btn.onclick = function() {
            makePromotionMove(from, to, color + btn.dataset.piece, true);
            promotionPanel.classList.add("hidden");
            selected = null;
            moveableSquares = [];
            drawBoard();
            if (!gameOver) setTimeout(autoAIMoveIfNeeded, 480);
        };
    });
    // Escape ile paneli kapatma
    promotionPanel.focus();
}
function makePromotionMove(from, to, piece, pushHistory) {
    if (!legalMoves(from).includes(to)) return;
    let move = {from, to, piece: board[from], taken: board[to], promote:true, promotePiece: piece};
    board[to] = piece;
    board[from] = "";
    lastMove = {from, to};
    turn = turn === "w" ? "b" : "w";
    if (pushHistory) {
        move.notation = PIECES[move.piece] + algebraic(from) + (move.taken ? "x" : "-") + algebraic(to) + "=" + PIECES[piece];
        moveHistory.push(move);
        historyBoards.push([...board]);
    }
    if (isGameOver()) {
        gameOver = true;
        gameResult = getGameResult();
        setTimeout(showOverlay, 350);
    }
}

// --------- HAMLE √úRETƒ∞Mƒ∞ VE KURALLAR ---------
function legalMoves(idx) {
    const piece = board[idx];
    if (!piece) return [];
    const color = piece[0], type = piece[1];
    let moves = [];
    const [r, c] = posToRC(idx);
    const dirs = {
        N: [[-2,-1],[-2,1],[2,-1],[2,1],[-1,-2],[1,2],[1,-2],[1,2]],
        B: [[-1,-1],[1,-1],[-1,1],[1,1]],
        R: [[-1,0],[1,0],[0,-1],[0,1]],
        Q: [[-1,-1],[1,-1],[-1,1],[1,1],[-1,0],[1,0],[0,-1],[0,1]],
        K: [[-1,-1],[1,-1],[-1,1],[1,1],[-1,0],[1,0],[0,-1],[0,1]]
    };
    // Piyon
    if (type === "P") {
        let dr = color === "w" ? -1 : 1;
        let f1 = rcToPos(r+dr,c), f2 = rcToPos(r+dr*2,c);
        if (board[f1] === "" && r+dr>=0 && r+dr<=7) {
            moves.push(f1);
            if (((color==="w"&&r===6)||(color==="b"&&r===1)) && board[f2]==="") moves.push(f2);
        }
        for (let dc of [-1,1]) {
            let cap = rcToPos(r+dr, c+dc);
            if (c+dc>=0&&c+dc<8 && isOppColor(board[cap], color)) moves.push(cap);
        }
    }
    // At
    if (type === "N") {
        for (let d of dirs.N) {
            let tr = r+d[0], tc = c+d[1], t = rcToPos(tr,tc);
            if (tr>=0&&tr<8&&tc>=0&&tc<8 && (!board[t]||isOppColor(board[t], color))) moves.push(t);
        }
    }
    // Fil & Vezir
    if (type === "B" || type === "Q") {
        for (let d of dirs.B) {
            for (let i=1; i<8; i++) {
                let tr=r+d[0]*i, tc=c+d[1]*i, t=rcToPos(tr,tc);
                if (tr<0||tr>7||tc<0||tc>7) break;
                if (!board[t]) moves.push(t);
                else { if (isOppColor(board[t],color)) moves.push(t); break; }
            }
        }
    }
    // Kale & Vezir
    if (type === "R" || type === "Q") {
        for (let d of dirs.R) {
            for (let i=1; i<8; i++) {
                let tr=r+d[0]*i, tc=c+d[1]*i, t=rcToPos(tr,tc);
                if (tr<0||tr>7||tc<0||tc>7) break;
                if (!board[t]) moves.push(t);
                else { if (isOppColor(board[t],color)) moves.push(t); break; }
            }
        }
    }
    // ≈ûah
    if (type === "K") {
        for (let d of dirs.K) {
            let tr = r+d[0], tc = c+d[1], t=rcToPos(tr,tc);
            if (tr>=0&&tr<8&&tc>=0&&tc<8 && (!board[t]||isOppColor(board[t],color))) moves.push(t);
        }
    }
    // ≈ûah √ßekme kontrol√º
    const realMoves = [];
    for (let t of moves) {
        const tempBoard = [...board];
        tempBoard[t] = tempBoard[idx];
        tempBoard[idx] = "";
        if (!isCheck(color, tempBoard)) realMoves.push(t);
    }
    return realMoves;
}
function isCheck(color, tempBoard=board) {
    const kingPos = tempBoard.findIndex(p=>p===color+"K");
    if (kingPos === -1) return true;
    const opp = color==="w"?"b":"w";
    for (let i=0; i<64; i++) {
        if (tempBoard[i] && tempBoard[i][0]===opp) {
            if (legalMovesRaw(i, tempBoard, opp).includes(kingPos)) return true;
        }
    }
    return false;
}
function legalMovesRaw(idx, tempBoard, color) {
    const piece = tempBoard[idx];
    if (!piece) return [];
    const type = piece[1];
    let moves = [];
    const [r, c] = posToRC(idx);
    const dirs = {
        N: [[-2,-1],[-2,1],[2,-1],[2,1],[-1,-2],[1,2],[1,-2],[1,2]],
        B: [[-1,-1],[1,-1],[-1,1],[1,1]],
        R: [[-1,0],[1,0],[0,-1],[0,1]],
        Q: [[-1,-1],[1,-1],[-1,1],[1,1],[-1,0],[1,0],[0,-1],[0,1]],
        K: [[-1,-1],[1,-1],[-1,1],[1,1],[-1,0],[1,0],[0,-1],[0,1]]
    };
    if (type === "P") {
        let dr = color === "w" ? -1 : 1;
        for (let dc of [-1,1]) {
            let cap = rcToPos(r+dr, c+dc);
            if (c+dc>=0&&c+dc<8 && tempBoard[cap] && tempBoard[cap][0]!==color) moves.push(cap);
        }
    }
    if (type === "N") for (let d of dirs.N) {
        let tr=r+d[0], tc=c+d[1], t=rcToPos(tr,tc);
        if (tr>=0&&tr<8&&tc>=0&&tc<8 && (!tempBoard[t]||tempBoard[t][0]!==color)) moves.push(t);
    }
    if (type === "B" || type === "Q") for (let d of dirs.B) {
        for (let i=1; i<8; i++) {
            let tr=r+d[0]*i, tc=c+d[1]*i, t=rcToPos(tr,tc);
            if (tr<0||tr>7||tc<0||tc>7) break;
            if (!tempBoard[t]) moves.push(t);
            else { if (tempBoard[t][0]!==color) moves.push(t); break; }
        }
    }
    if (type === "R" || type === "Q") for (let d of dirs.R) {
        for (let i=1; i<8; i++) {
            let tr=r+d[0]*i, tc=c+d[1]*i, t=rcToPos(tr,tc);
            if (tr<0||tr>7||tc<0||tc>7) break;
            if (!tempBoard[t]) moves.push(t);
            else { if (tempBoard[t][0]!==color) moves.push(t); break; }
        }
    }
    if (type === "K") for (let d of dirs.K) {
        let tr = r+d[0], tc = c+d[1], t=rcToPos(tr,tc);
        if (tr>=0&&tr<8&&tc>=0&&tc<8 && (!tempBoard[t]||tempBoard[t][0]!==color)) moves.push(t);
    }
    return moves;
}

// --------- HAMLE YAPMA, GERƒ∞ ALMA, OYUN SONU ---------
function makeMove(from, to, pushHistory) {
    if (!legalMoves(from).includes(to) || gameOver) {
        showToast(getText("aiMoveBlocked"), "error");
        return;
    }
    let move = {from, to, piece: board[from], taken: board[to]};
    board[to] = board[from];
    board[from] = "";
    lastMove = {from, to};
    turn = turn === "w" ? "b" : "w";
    selected = null;
    moveableSquares = [];
    if (pushHistory) {
        move.notation = PIECES[move.piece] + algebraic(from) + (move.taken ? "x" : "-") + algebraic(to);
        moveHistory.push(move);
        historyBoards.push([...board]);
    }
    playSound(move.taken ? "capture" : "move");
    if (isGameOver()) {
        gameOver = true;
        gameResult = getGameResult();
        setTimeout(showOverlay, 400);
    }
    drawBoard();
}
function undoMove() {
    if (moveHistory.length === 0 || gameOver) {
        showToast(getText("noUndo"), "error");
        return;
    }
    moveHistory.pop();
    historyBoards.pop();
    board = historyBoards.length ? [...historyBoards[historyBoards.length-1]] : [...startPos];
    lastMove = null;
    turn = (moveHistory.length%2===0) ? "w" : "b";
    gameOver = false;
    gameResult = null;
    drawBoard();
}
function resetBoard() {
    board = [...startPos];
    moveHistory = [];
    historyBoards = [];
    lastMove = null;
    turn = "w";
    gameOver = false;
    gameResult = null;
    selected = null;
    moveableSquares = [];
    drawBoard();
}
function jumpToMove(idx) {
    if (idx < 0 || idx >= historyBoards.length) return;
    board = [...historyBoards[idx]];
    moveHistory = moveHistory.slice(0, idx+1);
    historyBoards = historyBoards.slice(0, idx+1);
    turn = (moveHistory.length%2===0) ? "w" : "b";
    lastMove = moveHistory.length ? {from: moveHistory[idx].from, to: moveHistory[idx].to} : null;
    gameOver = false;
    gameResult = null;
    drawBoard();
}
function isGameOver() {
    for (let i=0; i<64; i++) {
        if (board[i] && board[i][0]===turn && legalMoves(i).length>0) return false;
    }
    return true;
}
function getGameResult() {
    if (isCheck(turn)) {
        return turn === "b" ? "win" : "lose";
    } else {
        return "draw";
    }
}
function showOverlay() {
    resultModal.classList.add("active");
    const msg = document.getElementById('resultMessage');
    const det = document.getElementById('resultDetails');
    if (gameResult === "win") {
        msg.innerText = getText("win");
        det.innerText = "";
        playSound("win");
    } else if (gameResult === "lose") {
        msg.innerText = getText("lose");
        det.innerText = "";
        playSound("lose");
    } else {
        msg.innerText = getText("draw");
        det.innerText = "";
        playSound("draw");
    }
}

// --------- AI (Minimax) ve Otomatik Hamle ---------
function aiMove() {
    if (gameOver || aiLocked) return;
    aiLocked = true;
    aiBtn.disabled = true;
    setTimeout(() => {
        let [move, score] = minimaxRoot(aiDepth, turn==="b");
        if (move) makeMove(move.from, move.to, true);
        aiLocked = false;
        aiBtn.disabled = false;
    }, 210);
}
function autoAIMoveIfNeeded() {
    if ((userSide === "white" && turn === "b") || (userSide === "black" && turn === "w")) {
        aiMove();
    }
}
function minimaxRoot(depth, isMaximizing) {
    let bestScore = isMaximizing ? -Infinity : Infinity;
    let bestMoves = [];
    for (let from = 0; from < 64; from++) {
        if (board[from] && board[from][0] === (isMaximizing ? "b" : "w")) {
            let moves = legalMoves(from);
            for (let to of moves) {
                let backup = [...board];
                let taken = board[to];
                let promote = false;
                // Terfi var mƒ± kontrol√º
                if (board[from][1]==="P" && (Math.floor(to/8)===0 || Math.floor(to/8)===7)) {
                    // Sadece vezire terfi (AI i√ßin sadele≈ütirilmi≈ü)
                    board[to] = board[from][0]+"Q";
                    promote = true;
                } else {
                    board[to] = board[from];
                }
                board[from] = "";
                let score = minimax(depth - 1, !isMaximizing, -Infinity, Infinity);
                board = backup;
                if ((isMaximizing && score > bestScore) || (!isMaximizing && score < bestScore)) {
                    bestScore = score;
                    bestMoves = [{ from, to }];
                } else if (score === bestScore) {
                    bestMoves.push({ from, to });
                }
            }
        }
    }
    if (bestMoves.length > 0) {
        if (aiRandomness > 0 && Math.random() < aiRandomness) {
            const i = Math.floor(Math.random() * bestMoves.length);
            return [bestMoves[i], bestScore];
        }
        return [bestMoves[Math.floor(Math.random()*bestMoves.length)], bestScore];
    }
    return [null, bestScore];
}
function minimax(depth, isMaximizing, alpha, beta) {
    if (depth === 0 || isGameOver()) return evaluateBoard();
    let bestScore = isMaximizing ? -Infinity : Infinity;
    for (let from = 0; from < 64; from++) {
        if (board[from] && board[from][0] === (isMaximizing ? "b" : "w")) {
            let moves = legalMoves(from);
            for (let to of moves) {
                let backup = [...board];
                let taken = board[to];
                let promote = false;
                // Terfi
                if (board[from][1]==="P" && (Math.floor(to/8)===0 || Math.floor(to/8)===7)) {
                    board[to] = board[from][0]+"Q";
                    promote = true;
                } else {
                    board[to] = board[from];
                }
                board[from] = "";
                let score = minimax(depth - 1, !isMaximizing, alpha, beta);
                board = backup;
                if (isMaximizing) {
                    bestScore = Math.max(bestScore, score);
                    alpha = Math.max(alpha, score);
                    if (beta <= alpha) return bestScore;
                } else {
                    bestScore = Math.min(bestScore, score);
                    beta = Math.min(beta, score);
                    if (beta <= alpha) return bestScore;
                }
            }
        }
    }
    return bestScore;
}
function evaluateBoard() {
    let score = 0;
    for (let i = 0; i < 64; i++) {
        const p = board[i];
        if (!p) continue;
        let val = PIECE_VALUES[p[1]] || 0;
        score += (p[0] === "w") ? val : -val;
    }
    if (isGameOver()) {
        if (isCheck(turn)) score += (turn === "w" ? -9999 : 9999);
    }
    return score + (Math.random() - 0.5) * aiRandomness * 2;
}

// --------- FEN, PGN, Hƒ∞NT ---------
function fenFromBoard() {
    let rows = [];
    for (let r = 0; r < 8; r++) {
        let row = "", empty = 0;
        for (let c = 0; c < 8; c++) {
            let p = board[r * 8 + c];
            if (!p) empty++;
            else {
                if (empty > 0) { row += empty; empty = 0; }
                let code = p[1];
                if (p[0] === "w") code = code.toUpperCase();
                else code = code.toLowerCase();
                row += code;
            }
        }
        if (empty > 0) row += empty;
        rows.push(row);
    }
    return rows.join("/") + " " + turn;
}
function getPGN() {
    let pgn = "";
    let moveNum = 1;
    moveHistory.forEach((m, i) => {
        if (i%2===0) pgn += (moveNum++) + ". ";
        pgn += m.notation + " ";
    });
    return pgn.trim();
}
function getHintMove() {
    let [move, score] = minimaxRoot(1, turn==="w");
    if (move) {
        let notation = PIECES[board[move.from]] + algebraic(move.from) + (board[move.to]?"x":"-") + algebraic(move.to);
        return { ...move, notation };
    }
    return null;
}

// --------- EVENTLER: BUTONLAR, MODAL, KLAVYE, DOKUNMA ---------
undoBtn.onclick = function() { undoMove(); };
resetBtn.onclick = function() { resetBoard(); };
aiBtn.onclick = function() {
    if (gameOver || aiLocked) {
        showToast(getText("aiMoveBlocked"), "error");
        return;
    }
    aiMove();
};
fenBtn.onclick = function() {
    try {
        let fen = fenFromBoard();
        navigator.clipboard.writeText(fen);
        showToast(getText("fenCopied"), "success");
    } catch {
        showToast("FEN kopyalanamadƒ±!", "error");
    }
};
$("startGameBtn").onclick = function() {
    try {
        setupGame();
    } catch {
        showToast(getText("startError"), "error");
    }
};
$("restartBtn").onclick = function() {
    resultModal.classList.remove("active");
    setupSection.classList.add("active");
    gameSection.classList.add("hidden");
    selected = null;
    moveableSquares = [];
    resetBoard();
};
$("themeSelect").onchange = function() {
    setTheme(this.value);
};
$("soundToggle").onchange = function() {
    soundEnabled = this.checked;
    saveUserPrefs();
};
$("sideSelect").onchange = function() { /* Oyun ba≈ülamadan taraf deƒüi≈ütirilebilir */ };

document.querySelectorAll(".level-btn").forEach(btn => {
    btn.onclick = function() {
        document.querySelectorAll(".level-btn").forEach(b => b.classList.remove("selected"));
        this.classList.add("selected");
        $("startGameBtn").disabled = false;
    };
});

document.getElementById("languageSelect").onchange = function() {
    setLanguage(this.value);
};

document.addEventListener("keydown", function(e) {
    // ESC modallarƒ± kapatƒ±r
    if (e.key === "Escape") {
        let openModals = document.querySelectorAll(".modal.active");
        openModals.forEach(modal => {
            if (!modal.id.startsWith("setup")) modal.classList.remove("active");
        });
    }
    // Ctrl+Z ile geri al
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "z") {
        if (!setupSection.classList.contains("active") &&
            !resultModal.classList.contains("active")) {
            undoMove();
        }
    }
    // Enter ile ta≈ü hareketi (se√ßildiyse ve sadece bir hamle uygunsa)
    if (e.key === "Enter" && selected !== null && moveableSquares.length === 1) {
        handleCellClick(moveableSquares[0]);
    }
});

// DOKUNMATƒ∞K destek
let touchStart = null;
chessBoard.addEventListener('touchstart', function (e) {
    if (e.touches.length === 1) {
        touchStart = e.touches[0];
    }
});
chessBoard.addEventListener('touchend', function (e) {
    touchStart = null;
});

// --------- AYARLAR PANELƒ∞, REHBER, Dƒ∞L, TEMA ---------
$("closeGuideBtn").onclick = function() {
    $("guideSection").classList.remove("active");
};
$("footerGuideLink").onclick = function(e) {
    e.preventDefault();
    openGuide();
};
$("navGuide").onclick = function(e) {
    e.preventDefault();
    openGuide();
};
function openGuide() {
    let guide = $("guideSection");
    guide.classList.add("active");
    let lang = localStorage.getItem("lang") || "tr";
    let data = JSON.parse(document.getElementById("guideJSON").textContent)[lang] || [];
    let html = "";
    data.forEach(item => {
        html += `<h3>${item.title}</h3><p>${item.content}</p>`;
    });
    document.getElementById("guideBody").innerHTML = html;
    $("closeGuideBtn").focus();
}
$("settingsBtn").onclick = function() {
    $("settingsSection").classList.add("active");
    $("themeSettings").value = localStorage.getItem("theme") || "classic";
};
$("closeSettingsBtn").onclick = function() {
    $("settingsSection").classList.remove("active");
};
$("settingsForm").onsubmit = function(e) {
    e.preventDefault();
    let lang = $("langSettings").value;
    let theme = $("themeSettings").value;
    soundEnabled = $("soundSettings").checked;
    animationsEnabled = $("animationSettings").checked;
    setLanguage(lang);
    setTheme(theme);
    saveUserPrefs();
    $("settingsSection").classList.remove("active");
    showToast(getText("settingsSaved"), "success");
};

// --------- HINT, PGN, PAYLA≈ûIM ---------
$("hintBtn").onclick = function() {
    let move = getHintMove();
    if (move && typeof move.from === "number" && typeof move.to === "number") {
        let cells = document.querySelectorAll(".chess-cell");
        cells[move.from].classList.add("highlight");
        cells[move.to].classList.add("highlight");
        showToast("ƒ∞pucu: " + move.notation, "success");
        setTimeout(()=>{
            cells[move.from].classList.remove("highlight");
            cells[move.to].classList.remove("highlight");
        }, 2600);
    }
};
$("exportPGNBtn").onclick = function() {
    let pgn = getPGN();
    let blob = new Blob([pgn], {type: "text/plain"});
    let url = URL.createObjectURL(blob);
    let a = document.createElement('a');
    a.href = url;
    a.download = "higer-chess.pgn";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showToast("PGN kaydedildi!", "success");
};
$("shareBtn").onclick = function() {
    let fen = fenFromBoard();
    let url = window.location.href;
    let msg = "HIGER Satran√ß'ta konumum:\n" + fen + "\n" + url;
    if (navigator.share) {
        navigator.share({
            title: "HIGER Chess",
            text: msg,
            url: url
        });
    } else {
        navigator.clipboard.writeText(msg);
        showToast("Payla≈üƒ±m panoya kopyalandƒ±!", "success");
    }
};

// --------- PWA & MANIFEST ---------
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js').catch(function(){});
    });
}
(function(){
    let link = document.createElement("link");
    link.rel = "manifest";
    link.href = "manifest.json";
    document.head.appendChild(link);
})();

// --------- BA≈ûLATMA ---------
window.onload = function() {
    loadUserPrefs();
    drawBoard();
    $("startGameBtn").disabled = true;
};

// --------- DOSYA SONU (chess.js, birle≈ütirilmi≈ü ve mod√ºler) ---------</script></body></html>